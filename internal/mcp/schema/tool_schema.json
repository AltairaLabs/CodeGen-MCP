{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "MCP Tool Registry Schema",
  "description": "Schema for language profiles and tool descriptors exposed by the MCP Coordinator.",
  "type": "object",
  "properties": {
    "languages": {
      "type": "array",
      "items": { "$ref": "#/definitions/languageProfile" }
    },
    "tools": {
      "type": "array",
      "items": { "$ref": "#/definitions/toolDescriptor" }
    }
  },
  "required": ["languages", "tools"],
  "additionalProperties": false,

  "definitions": {
    "languageProfile": {
      "type": "object",
      "properties": {
        "id": { "type": "string", "description": "Language identifier (e.g., 'python', 'go')." },
        "display_name": { "type": "string" },
        "file_extensions": { "type": "array", "items": { "type": "string" } },
        "formatter": { "type": "string", "description": "Canonical formatter command (e.g., 'black')." },
        "ast_tools": { "type": "array", "items": { "type": "string" }, "description": "List of AST/refactor tools available." },
        "text_commands": { "type": "array", "items": { "type": "string" }, "description": "Allowed text-based helpers (curated subset)." },
        "test_command": { "type": "string" },
        "notes": { "type": "string" }
      },
      "required": ["id"],
      "additionalProperties": false
    },

    "toolDescriptor": {
      "type": "object",
      "properties": {
        "tool_id": { "type": "string", "description": "Unique tool identifier (e.g., 'fs.write')." },
        "language": { "type": ["string", "null"], "description": "Optional language id this tool applies to; null for language-agnostic tools." },
        "description": { "type": "string" },
        "atomic": { "type": "boolean", "description": "Whether the operation is atomic/transactional." },
        "dry_run_supported": { "type": "boolean" },
        "input_schema": { "type": "object", "description": "JSON schema describing the tool's input args." },
        "output_schema": { "type": "object", "description": "JSON schema describing the tool's output." },
        "max_files_affected": { "type": ["integer", "null"], "description": "Optional safe cap for file-affecting operations." },
        "allowed_scopes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Optional scopes or permission labels required to call the tool." 
        }
      },
      "required": ["tool_id", "description", "input_schema", "output_schema"],
      "additionalProperties": false
    }
  }
}
